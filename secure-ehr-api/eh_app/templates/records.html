<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Historia Cl√≠nica - EHR Seguro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .sidebar {
        min-height: 100vh;
        background-color: #f1f3f5;
        padding-top: 2rem;
      }
      .sidebar a {
        text-decoration: none;
        display: block;
        padding: 0.75rem 1rem;
        color: #495057;
        font-weight: 500;
      }
      .sidebar a.active {
        background-color: #e7f1ff;
        color: #0d6efd;
        border-left: 4px solid #0d6efd;
      }
      .medical-record {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 0.1rem 0.5rem rgba(0, 0, 0, 0.05);
      }
      .tab-content {
        padding: 1.5rem;
      }
      .form-edit {
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 0.5rem;
      }
      .timeline {
        position: relative;
        padding-left: 2rem;
      }
      .timeline-item {
        position: relative;
        padding-bottom: 1.5rem;
      }
      .timeline-item:before {
        content: "";
        position: absolute;
        left: -1.5rem;
        top: 0;
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        background-color: #0d6efd;
      }
      .timeline-item:after {
        content: "";
        position: absolute;
        left: -1rem;
        top: 0.5rem;
        width: 2px;
        height: 100%;
        background-color: #dee2e6;
      }
      .timeline-item:last-child:after {
        display: none;
      }
      .loading-placeholder {
        min-height: 100px;
        background-color: #f1f3f5;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .loading-text {
        color: #6c757d;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 sidebar">
          <h5 class="text-center mb-4">üè• EHR Seguro</h5>
          <a href="/dashboard"
            ><i class="bi bi-speedometer2 me-2"></i>Dashboard</a
          >
          <a href="/patients"
            ><i class="bi bi-people-fill me-2"></i>Pacientes</a
          >
          <a href="#" class="active"
            ><i class="bi bi-file-medical me-2"></i>Historias Cl√≠nicas</a
          >
          <a href="/schedule"
            ><i class="bi bi-calendar-check me-2"></i>Agenda</a
          >
          <a href="/profile"><i class="bi bi-person-circle me-2"></i>Perfil</a>
          <a href="/logout" class="text-danger mt-4 d-block"
            ><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesi√≥n</a
          >
        </div>

        <!-- Main content -->
        <div class="col-md-9 col-lg-10 py-4 px-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3>Historia Cl√≠nica</h3>
            <div>
              <button id="editBtn" class="btn btn-primary me-2">
                <i class="bi bi-pencil-square me-1"></i>Editar
              </button>
              <button id="printBtn" class="btn btn-outline-secondary">
                <i class="bi bi-printer me-1"></i>Imprimir
              </button>
            </div>
          </div>

          <!-- Pesta√±as -->
          <ul class="nav nav-tabs mb-4" id="recordTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="general-tab"
                data-bs-toggle="tab"
                data-bs-target="#general"
                type="button"
                role="tab"
              >
                Datos Generales
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="history-tab"
                data-bs-toggle="tab"
                data-bs-target="#history"
                type="button"
                role="tab"
              >
                Historial M√©dico
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="prescriptions-tab"
                data-bs-toggle="tab"
                data-bs-target="#prescriptions"
                type="button"
                role="tab"
              >
                Recetas
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="notes-tab"
                data-bs-toggle="tab"
                data-bs-target="#notes"
                type="button"
                role="tab"
              >
                Notas
              </button>
            </li>
          </ul>

          <!-- Contenido de las pesta√±as -->
          <div class="tab-content medical-record" id="recordTabsContent">
            <!-- Pesta√±a Datos Generales -->
            <div class="tab-pane fade show active" id="general" role="tabpanel">
              <div id="generalView">
                <div class="row mb-4">
                  <div class="col-md-2">
                    <div class="text-center">
                      <div
                        class="loading-placeholder"
                        style="
                          width: 150px;
                          height: 150px;
                          margin: 0 auto 10px auto;
                        "
                      ></div>
                      <p class="text-muted small" id="patient-id">
                        ID: Cargando...
                      </p>
                    </div>
                  </div>
                  <div class="col-md-10">
                    <h4 id="patient-name">Cargando datos del paciente...</h4>
                    <div class="row mt-3">
                      <div class="col-md-4">
                        <p>
                          <strong>Fecha de Nacimiento:</strong>
                          <span id="patient-birthdate">--/--/----</span>
                        </p>
                        <p>
                          <strong>Edad:</strong>
                          <span id="patient-age">-- a√±os</span>
                        </p>
                        <p>
                          <strong>Sexo:</strong>
                          <span id="patient-gender">-------</span>
                        </p>
                      </div>
                      <div class="col-md-4">
                        <p>
                          <strong>Tel√©fono:</strong>
                          <span id="patient-phone">-----------</span>
                        </p>
                        <p>
                          <strong>Email:</strong>
                          <span id="patient-email">-----------</span>
                        </p>
                        <p>
                          <strong>Grupo Sangu√≠neo:</strong>
                          <span id="patient-bloodtype">---</span>
                        </p>
                      </div>
                      <div class="col-md-4">
                        <p>
                          <strong>Alergias:</strong>
                          <span id="patient-allergies">Ninguna registrada</span>
                        </p>
                        <p>
                          <strong>M√©dico de Cabecera:</strong>
                          <span id="patient-doctor">-----------</span>
                        </p>
                        <p>
                          <strong>√öltima visita:</strong>
                          <span id="patient-lastvisit">--/--/----</span>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div id="generalEdit" class="form-edit" style="display: none">
                <form id="patientForm">
                  <input type="hidden" id="patientId" name="patientId" />
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Nombre</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editFirstName"
                        name="firstName"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Apellidos</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editLastName"
                        name="lastName"
                        required
                      />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-4">
                      <label class="form-label">Fecha de Nacimiento</label>
                      <input
                        type="date"
                        class="form-control"
                        id="editBirthdate"
                        name="birthdate"
                        required
                      />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Sexo</label>
                      <select
                        class="form-select"
                        id="editGender"
                        name="gender"
                        required
                      >
                        <option value="" disabled selected>
                          Seleccionar...
                        </option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Grupo Sangu√≠neo</label>
                      <select
                        class="form-select"
                        id="editBloodtype"
                        name="bloodtype"
                      >
                        <option value="" disabled selected>
                          Seleccionar...
                        </option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                      </select>
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Tel√©fono</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="editPhone"
                        name="phone"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="editEmail"
                        name="email"
                      />
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Alergias</label>
                    <textarea
                      class="form-control"
                      id="editAllergies"
                      name="allergies"
                      rows="2"
                    ></textarea>
                  </div>
                  <div class="d-flex justify-content-end">
                    <button
                      type="button"
                      id="cancelEdit"
                      class="btn btn-outline-secondary me-2"
                    >
                      Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                      Guardar Cambios
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Pesta√±a Historial M√©dico -->
            <div class="tab-pane fade" id="history" role="tabpanel">
              <div class="timeline" id="medicalHistory">
                <div class="loading-placeholder">
                  <span class="loading-text">Cargando historial m√©dico...</span>
                </div>
              </div>
            </div>

            <!-- Pesta√±a Recetas -->
            <div class="tab-pane fade" id="prescriptions" role="tabpanel">
              <div class="d-flex justify-content-end mb-3">
                <button class="btn btn-primary" id="newPrescriptionBtn">
                  <i class="bi bi-plus-circle me-1"></i>Nueva Receta
                </button>
              </div>

              <div id="prescriptionsList">
                <div class="loading-placeholder" style="min-height: 200px">
                  <span class="loading-text">Cargando recetas m√©dicas...</span>
                </div>
              </div>
            </div>

            <!-- Pesta√±a Notas -->
            <div class="tab-pane fade" id="notes" role="tabpanel">
              <div class="mb-4">
                <textarea
                  class="form-control"
                  id="newNote"
                  rows="4"
                  placeholder="A√±adir nueva nota..."
                ></textarea>
                <div class="d-flex justify-content-end mt-2">
                  <button class="btn btn-primary" id="saveNoteBtn">
                    Guardar Nota
                  </button>
                </div>
              </div>

              <div id="medicalNotes">
                <div class="loading-placeholder" style="min-height: 150px">
                  <span class="loading-text">Cargando notas m√©dicas...</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Toggle entre vista y edici√≥n
      document.getElementById("editBtn").addEventListener("click", function () {
        const viewMode = document.getElementById("generalView");
        const editMode = document.getElementById("generalEdit");

        if (viewMode.style.display === "none") {
          viewMode.style.display = "block";
          editMode.style.display = "none";
          this.innerHTML = '<i class="bi bi-pencil-square me-1"></i>Editar';
        } else {
          viewMode.style.display = "none";
          editMode.style.display = "block";
          this.innerHTML = '<i class="bi bi-eye me-1"></i>Ver';
        }
      });

      // Cancelar edici√≥n
      document
        .getElementById("cancelEdit")
        .addEventListener("click", function () {
          document.getElementById("generalView").style.display = "block";
          document.getElementById("generalEdit").style.display = "none";
          document.getElementById("editBtn").innerHTML =
            '<i class="bi bi-pencil-square me-1"></i>Editar';
        });

      // Funci√≥n para imprimir
      document
        .getElementById("printBtn")
        .addEventListener("click", function () {
          window.print();
        });

      // Ejemplo de c√≥mo cargar los datos del paciente
      document.addEventListener("DOMContentLoaded", function () {
        // Obtener el ID del paciente de la URL
        const patientId = window.location.pathname.split("/").pop();

        // Simular carga de datos (reemplazar con llamada real a tu API)
        setTimeout(function () {
          // Aqu√≠ ir√≠a tu llamada fetch al backend
          /*
      fetch(`/api/patients/${patientId}`)
        .then(response => response.json())
        .then(data => loadPatientData(data));
      */

          // Por ahora mostramos placeholders vac√≠os
          document.getElementById("patient-id").textContent = "ID: HC-0000";
          document.getElementById("patient-name").textContent =
            "Nombre del paciente";
          document.getElementById("medicalHistory").innerHTML = `
        <div class="alert alert-info">No hay historial m√©dico registrado</div>
      `;
          document.getElementById("prescriptionsList").innerHTML = `
        <div class="alert alert-info">No hay recetas m√©dicas registradas</div>
      `;
          document.getElementById("medicalNotes").innerHTML = `
        <div class="alert alert-info">No hay notas m√©dicas registradas</div>
      `;
        }, 1000);
      });

      // Funci√≥n para cargar datos del paciente (ejemplo)
      function loadPatientData(patientData) {
        // Datos generales
        document.getElementById(
          "patient-id"
        ).textContent = `ID: ${patientData.recordId}`;
        document.getElementById("patient-name").textContent =
          patientData.fullName;

        // Llenar formulario de edici√≥n
        document.getElementById("patientId").value = patientData.id;
        document.getElementById("editFirstName").value = patientData.firstName;
        document.getElementById("editLastName").value = patientData.lastName;
        document.getElementById("editBirthdate").value = patientData.birthdate;
        document.getElementById("editGender").value = patientData.gender;
        document.getElementById("editBloodtype").value = patientData.bloodType;
        document.getElementById("editPhone").value = patientData.phone;
        document.getElementById("editEmail").value = patientData.email;
        document.getElementById("editAllergies").value = patientData.allergies;

        // Actualizar vista
        document.getElementById("patient-birthdate").textContent =
          patientData.formattedBirthdate;
        document.getElementById("patient-age").textContent = patientData.age;
        document.getElementById("patient-gender").textContent =
          patientData.gender;
        document.getElementById("patient-phone").textContent =
          patientData.phone;
        document.getElementById("patient-email").textContent =
          patientData.email;
        document.getElementById("patient-bloodtype").textContent =
          patientData.bloodType;
        document.getElementById("patient-allergies").textContent =
          patientData.allergies || "Ninguna registrada";
        document.getElementById("patient-doctor").textContent =
          patientData.primaryDoctor;
        document.getElementById("patient-lastvisit").textContent =
          patientData.lastVisit;

        // Cargar historial m√©dico
        if (
          patientData.medicalHistory &&
          patientData.medicalHistory.length > 0
        ) {
          let historyHtml = "";
          patientData.medicalHistory.forEach((entry) => {
            historyHtml += `
          <div class="timeline-item">
            <h5>${entry.title}</h5>
            <p class="text-muted small">${entry.date} - ${entry.doctor}</p>
            <p>${entry.notes}</p>
            ${
              entry.diagnosis
                ? `<p><strong>Diagn√≥stico:</strong> ${entry.diagnosis}</p>`
                : ""
            }
            ${
              entry.treatment
                ? `<p><strong>Tratamiento:</strong> ${entry.treatment}</p>`
                : ""
            }
          </div>
        `;
          });
          document.getElementById("medicalHistory").innerHTML = historyHtml;
        }

        // Cargar recetas (similar al historial)
        // Cargar notas (similar al historial)
      }
    </script>
  </body>
</html>
